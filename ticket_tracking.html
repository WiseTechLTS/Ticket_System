<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Track Tickets - Unified IT Ticket System</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome for iconography -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <!-- Global Styles -->
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <!-- Dark Mode Toggle Button -->
  <button id="toggleTheme" class="btn btn-secondary m-2">
    <i class="fas fa-adjust"></i> Toggle Theme
  </button>
  
  <!-- Main container -->
  <main class="container my-5">
    <header class="text-center mb-4">
      <h1>Track Tickets</h1>
      <p class="lead">Monitor the status of your open tickets in real-time.</p>
    </header>
    
    <!-- Search and Filter Controls -->
    <div class="row mb-3">
      <div class="col-md-6">
        <input type="text" id="ticketSearch" class="form-control" placeholder="Search tickets by keyword..." />
      </div>
      <div class="col-md-6">
        <select id="ticketFilter" class="form-select">
          <option value="">Filter by Status</option>
          <option value="open">Open</option>
          <option value="in-progress">In Progress</option>
          <option value="closed">Closed</option>
        </select>
      </div>
    </div>
    
    <!-- Ticket list container -->
    <div id="trackingTickets" class="tracking-list">
      <!-- Open ticket items are dynamically injected -->
    </div>
  </main>
  
  <!-- Modal for Ticket Details -->
  <div class="modal fade" id="ticketModal" tabindex="-1" aria-labelledby="ticketModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="ticketModalLabel" class="modal-title">Ticket Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Ticket details dynamically injected here -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Bootstrap Bundle JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- External JavaScript -->
  <script defer src="/main.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggleThemeButton = document.getElementById("toggleTheme");
    const ticketSearchInput = document.getElementById("ticketSearch");
    const ticketFilterSelect = document.getElementById("ticketFilter");
    const trackingTickets = document.getElementById("trackingTickets");
  
    // Toggle dark mode for enhanced user experience
    toggleThemeButton.addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
    });
  
    // Sample ticket data to simulate dynamic content
    const tickets = [
      { id: 1, title: "Login Issue", status: "open", description: "User unable to login." },
      { id: 2, title: "Error 404", status: "in-progress", description: "Page not found error." },
      { id: 3, title: "Server Downtime", status: "closed", description: "Scheduled maintenance completed." }
    ];
  
    // Render tickets based on search and filter criteria
    function renderTickets(filter = "", status = "") {
      trackingTickets.innerHTML = "";
      let filteredTickets = tickets.filter(ticket => {
        const matchesFilter = ticket.title.toLowerCase().includes(filter.toLowerCase());
        const matchesStatus = status ? ticket.status === status : true;
        return matchesFilter && matchesStatus;
      });
  
      filteredTickets.forEach(ticket => {
        const ticketElement = document.createElement("div");
        ticketElement.classList.add("card", "mb-2", "ticket-item");
        ticketElement.innerHTML = `
          <div class="card-body">
            <h5 class="card-title">${ticket.title}</h5>
            <p class="card-text">Status: ${ticket.status}</p>
            <button class="btn btn-primary view-details" data-id="${ticket.id}">View Details</button>
          </div>
        `;
        trackingTickets.appendChild(ticketElement);
      });
    }
  
    // Initial render of tickets
    renderTickets();
  
    // Event listener for live ticket search
    ticketSearchInput.addEventListener("input", (e) => {
      renderTickets(e.target.value, ticketFilterSelect.value);
    });
  
    // Event listener for status filter selection
    ticketFilterSelect.addEventListener("change", (e) => {
      renderTickets(ticketSearchInput.value, e.target.value);
    });
  
    // Event delegation for modal activation upon ticket detail request
    trackingTickets.addEventListener("click", (e) => {
      if (e.target.classList.contains("view-details")) {
        const ticketId = e.target.getAttribute("data-id");
        const ticket = tickets.find(t => t.id == ticketId);
        if (ticket) {
          const modalBody = document.querySelector("#ticketModal .modal-body");
          modalBody.innerHTML = `
            <p><strong>Title:</strong> ${ticket.title}</p>
            <p><strong>Status:</strong> ${ticket.status}</p>
            <p><strong>Description:</strong> ${ticket.description}</p>
          `;
          const ticketModal = new bootstrap.Modal(document.getElementById("ticketModal"));
          ticketModal.show();
        }
      }
    });
  });
</script>  
</body>
</html>
